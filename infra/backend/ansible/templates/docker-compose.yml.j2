name: bridge-server

services:
  celery:
    image: ghcr.io/santanu2310/bridge-rabbitmq/celery:master-ca191a0
    environment:
      - MONGOD_URL={{ MONGOD_URL }}
      - JWT_ACCESS_SECRET_KEY={{ JWT_ACCESS_SECRET_KEY }}
      - JWT_REFRESH_SECRET_KEY={{ JWT_REFRESH_SECRET_KEY }}
      - AWS_ACCESS_KEY={{ AWS_ACCESS_KEY }}
      - AWS_SECRET_KEY={{ AWS_SECRET_KEY }}
      - BUCKET_NAME={{ BUCKET_NAME }}
      - RABBITMQ_USER_NAME={{ RABBITMQ_USER_NAME }}
      - RABBITMQ_USER_PASSWORD={{ RABBITMQ_USER_PASSWORD }}
      - CELERY_BROKER_URL={{ CELERY_BROKER_URL }}


  app:
    container_name: bridge-server
    image: ghcr.io/santanu2310/bridge-rabbitmq/fastapi:master-ca191a0@sha256:8ab343115355c24f6100db889ee8c9b141fa5d1f61623ded2884b002896bf1aa
    ports:
        - "8000:8000"
    environment:
      - MONGOD_URL={{ MONGOD_URL }}
      - JWT_ACCESS_SECRET_KEY={{ JWT_ACCESS_SECRET_KEY }}
      - JWT_REFRESH_SECRET_KEY={{ JWT_REFRESH_SECRET_KEY }}
      - AWS_ACCESS_KEY={{ AWS_ACCESS_KEY }}
      - AWS_SECRET_KEY={{ AWS_SECRET_KEY }}
      - BUCKET_NAME={{ BUCKET_NAME }}
      - RABBITMQ_USER_NAME={{ RABBITMQ_USER_NAME }}
      - RABBITMQ_USER_PASSWORD={{ RABBITMQ_USER_PASSWORD }}
      - CELERY_BROKER_URL={{ CELERY_BROKER_URL }}

    restart: always
    depends_on:
      celery:
        condition: service_started
